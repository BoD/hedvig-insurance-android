query EmbarkStory($name: String!) {
  embarkStory(name: $name) {
    startPassage
    passages {
      name
      id
      messages {
        ...MessageFragment
      }
      response {
        ...MessageFragment
      }
      redirects {
        ... on EmbarkRedirectUnaryExpression {
          unaryType: type
          to
          passedExpressionKey
          passedExpressionValue
        }
        ... on EmbarkRedirectBinaryExpression {
          binaryType: type
          to
          key
          value
          passedExpressionKey
          passedExpressionValue
        }
        ... on EmbarkRedirectMultipleExpressions {
          multipleExpressionType: type
          to
          passedExpressionKey
          passedExpressionValue
          subExpressions {
            ...SubExpressionFragment
          }
        }
      }
      action {
        ... on EmbarkSelectAction {
          data {
            options {
              link {
                ...EmbarkLinkFragment
              }
              keys
              values
            }
          }
        }
        ... on EmbarkTextAction {
          data {
            key
            link {
              ...EmbarkLinkFragment
            }
            placeholder
          }
        }
        ... on EmbarkTextActionSet {
          data {
            link{
              ...EmbarkLinkFragment
            }
            textActions {
              data {
                key
                placeholder
              }
            }
          }
        }
      }
      api {
        ...ApiFragment
      }
      tooltips {
        title
        description
      }
    }
  }
}

fragment EmbarkLinkFragment on EmbarkLink {
  name
  label
}

fragment MessageFragment on EmbarkMessage {
  expressions {
    ... on EmbarkExpressionUnary {
      unaryType: type
      text
    }
    ... on EmbarkExpressionBinary {
      binaryType: type
      key
      value
      text
    }
    ... on EmbarkExpressionMultiple {
      multipleType: type
      text
      subExpressions {
        ...SubExpressionFragment
      }
    }
  }
  text
}

fragment SubExpressionFragment on EmbarkExpression {
  ... on EmbarkExpressionUnary {
    unaryType: type
    text
  }
  ... on EmbarkExpressionBinary {
    binaryType: type
    key
    value
    text
  }
  ... on EmbarkExpressionMultiple {
    multipleType: type
    text
    subExpressions {
      ... on EmbarkExpressionUnary {
        unaryType: type
        text
      }
      ... on EmbarkExpressionBinary {
        binaryType: type
        key
        value
        text
      }
    }
  }
}

fragment ApiFragment on EmbarkApi {
  ... on EmbarkApiGraphQLQuery {
    data {
      query
      results {
        key
        as
      }
      errors {
        contains
        next {
          ...EmbarkLinkFragment
        }
      }
      variables {
        ... on EmbarkAPIGraphQLSingleVariable {
          key
          from
          as
        }
        ... on EmbarkAPIGraphQLGeneratedVariable {
          key
          storeAs
          type
        }
      }
      next {
        ...EmbarkLinkFragment
      }
    }
  }
}
